---
title: 第3-6节：支付回调处理
pay: https://t.zsxq.com/Ydjmt
---

# 《小型支付商城系统》第3-6节：支付回调处理

作者：小傅哥
<br/>博客：[https://bugstack.cn](https://bugstack.cn)

> 沉淀、分享、成长，让自己和他人都能有所收获！😄

## 一、本章诉求

对支付流程收尾，完成支付回调、掉单补偿、超时关单的处理，以及监听支付成功消息。

到本节的处理后，我们就把支付流程全部做完了。其实这也是面试中喜欢的问的场景，只有把一个支付的流程，从下单到支付再到回调处理，以及处理各项补偿和监听。面试官才会觉得你是真的对接了支付，而不是在描述一个 CRUD 流程。

## 二、业务流程

如图，本节我们来完成支付宝沙箱回调和补偿的流程；

<div align="center">
    <img src="https://bugstack.cn/images/article/project/s-pay-mall/s-pay-mall-2-2-05.png" width="850px">
</div>

- 本节完成支付成功后的回调处理，更新数据库订单状态。同时发送MQ消息。比如一些发货场景，就是这个MQ发送出来之后做的处理。
- 另外，我们在完成一些关于超时关单、掉单补偿的流程。